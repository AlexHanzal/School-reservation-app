<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Day App</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/buttons.css">
    <link rel="stylesheet" href="/css/responsive.css">
</head>
<body>
  <header class="header" id="header">
    <div id="mobile-menu-container">
      <!-- Mobile sidebar toggle will be added here by JS -->
    </div>
    <h1 class="title">Zaber si</h1>
    <div class="window-controls">
        <button id="login-button" class="login-button" data-tooltip="Click to login or logout">Login</button>
        <button id="logout-button" style="display: none;" data-tooltip="Click to logout">Log out</button>
    </div>
  </header>

  <!-- Add login overlay and menu after header -->
  <div class="login-overlay" id="login-overlay"></div>
  <div class="login-menu" id="login-menu">
    <button class="close-accounts-button" id="close-login" data-tooltip="Close login dialog">×</button>
    <h3>User Login</h3>
    <div class="input-group">
        <label for="user-select">User:</label>
        <select id="user-select" data-tooltip="Choose your user account">
            <option value="">Select a user</option>
        </select>
    </div>
    <div class="input-group">
        <label for="password-input">Password</label>
        <input type="password" id="password-input" placeholder="Enter password" data-tooltip="Enter your password">
    </div>
    <div class="login-error" id="login-error"></div>
    <button id="submit-login" class="confirm-verification" data-tooltip="Login with selected credentials">Login</button>
  </div>
  
  <!-- Replace the existing sidebar with this well-structured version -->
  <aside class="sidebar">
    <ul>
      <li id="dynamic-links-container"><!-- Dynamic buttons will be added here --></li>
      <li><button class="create-new" id="create-new" data-tooltip="Create a new class timetable">+</button></li>
    </ul>
    <button id="accounts-button" class="admin-button" data-tooltip="Manage user accounts (Admin only)">Accounts</button>
    <button class="admin-button" id="admin-button" data-tooltip="Enter admin verification code to access admin features">Admin</button>
  </aside>

  <!-- Add accounts overlay -->
  <div class="accounts-overlay" id="accounts-overlay"></div>
  
  <div class="select-screen" id="select-screen">
    <div class="select-window">
      <button class="close-select" id="close-select" class="close-create-new" data-tooltip="Close this dialog">X</button>
      <div class="input-group">
        <label for="name-input">Name:</label>
        <input type="text" id="name-input" placeholder="Enter name">
      </div>
      <div class="input-group">
        <label for="type-select">Type:</label>
        <select id="type-select">
          <option value="thing">Thing</option>
          <option value="class">Class</option>
        </select>
      </div>
      <button class="submit-button" id="submit-button" data-tooltip="Create the new class">Create</button>
    </div>
  </div>
  
  <!-- Update the time-table section -->
  <div class="time-table" style="display: none;">
    <h2>Select a Class</h2>
    <div class="bottom-content">
      <!-- Hide the default calendar -->
      </div>
      <div id="week-view-title" style="text-align: center; margin-bottom: 10px; font-weight: bold;"></div>
      <div class="table-container">
        <table class="week-table">
          <thead>
            <tr>
              <th></th>
              <th>8:00</th>
              <th>9:00</th>
              <th>10:00</th>
              <th>11:00</th>
              <th>12:00</th>
              <th>13:00</th>
              <th>14:00</th>
              <th>15:00</th>
              <th>16:00</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Mon</strong></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
            </tr>
            <tr>
              <td><strong>Tue</strong></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
            </tr>
            <tr>
              <td><strong>Wed</strong></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
            </tr>
            <tr>
              <td><strong>Thu</strong></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
            </tr>
            <tr>
              <td><strong>Fri</strong></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
              <td contenteditable="false"></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="time-table-buttons">
        <button class="edit-button" data-tooltip="Edit timetable entries">Edit</button>
        <button class="save-button" style="display: none;" data-tooltip="Save changes to timetable">Save</button>
        <button class="set-week-button" data-tooltip="Set the week for this timetable">Set Week</button>
        <button class="toggle-permanent-btn" id="toggle-permanent-btn" style="display: none;" data-tooltip="Toggle permanent hours mode">Permanent Hours: OFF</button>
      </div>
    </div>
  </div>

  <!-- Calendar Popup -->
  <div id="calendarPopupOverlay" class="calendar-popup-overlay">
      <div id="calendarPopup" class="calendar-popup">
          <div class="calendar-popup-header">
              <h3>Select Week</h3>
              <button id="closeCalendarPopup" class="close-calendar-popup">&times;</button>
          </div>
          <div class="calendar-popup-content">
              <div class="calendar-navigation">
                  <button id="calendarPrevBtn" class="calendar-nav-btn prev">&laquo;</button>
                  <div class="popup-calendar-header">
                      <h4 id="popupCalendarTitle">Calendar</h4>
                  </div>
                  <button id="calendarNextBtn" class="calendar-nav-btn next">&raquo;</button>
                  <button id="calendarTodayBtn" class="calendar-nav-btn today">Today</button>
              </div>
              <div id="popupCalendar" class="popup-calendar">
                  <!-- Calendar will be generated here -->
              </div>
          </div>
      </div>
  </div>

  <div class="pop-up" id="pop-up">
    <div class="calendar-header">
      <h2 class="calendar-title" id="calendar-title"></h2>
    </div>
    <button class="close-button" id="close-button">X</button>
    <div class="calendar" id="calendar"></div>
    <div class="calendar-buttons">
      <button class="prev-button" data-tooltip="Previous month">&lt;</button>
      <button class="next-button" data-tooltip="Next month">&gt;</button>
    </div>
  </div>
  <div class="verification-window" id="verification-window">
    <div class="verification-content">
      <h2>Admin Verification</h2>
      <input type="password" id="verification-code" placeholder="Enter verification code" data-tooltip="Enter admin verification code">
      <div class="verification-buttons">
        <button id="confirm-verification" class="confirm-verification" data-tooltip="Verify admin access">Verify</button>
        <button id="close-verification" class="close-menu" data-tooltip="Cancel verification">&times;</button>
      </div>
    </div>
  </div>

  <!-- Logout Confirmation Dialog -->
  <div id="logoutOverlay" class="logout-overlay">
    <div id="logoutConfirmDialog" class="logout-confirm">
      <div class="logout-confirm-content">
        <h3>Confirm Logout</h3>
        <p>Are you sure you want to log out?</p>
        <div class="logout-buttons">
          <button id="confirm-logout">Yes, Logout</button>
          <button id="cancel-logout">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/renderer.js"></script>
  <script>
    // Add event listener to show save button when admin mode is activated
    document.getElementById('admin-button').addEventListener('click', function() {
      console.log('Admin button clicked');
      // Admin verification will now be handled in the setupAdminButton function
    });
    
    // Debug helper - logs when verification window appears/disappears
    const verificationWindow = document.getElementById('verification-window');
    if (verificationWindow) {
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.attributeName === 'style' || mutation.attributeName === 'class') {
            console.log('Verification window visibility changed:', 
              verificationWindow.style.display, 
              verificationWindow.classList.contains('active'));
          }
        });
      });
      
      observer.observe(verificationWindow, { attributes: true });
    }
    
    // Debug helper for keyboard shortcuts
    console.log('Debug mode can be activated with Shift+A+S');
    
    // Add a direct test button (only in development)
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
      const testButton = document.createElement('button');
      testButton.textContent = 'Debug Mode Test';
      testButton.style.position = 'fixed';
      testButton.style.bottom = '10px';
      testButton.style.left = '10px';
      testButton.style.zIndex = '9999';
      testButton.onclick = function() {
        document.body.classList.toggle('debug-mode');
        if (document.body.classList.contains('debug-mode')) {
          enableDebugMode();
        } else {
          disableDebugMode();
        }
      };
      
      document.body.appendChild(testButton);
    }
  </script>
  <div class="custom-alert-overlay" id="alertOverlay"></div>
  <div class="custom-alert" id="customAlert">
    <h2>Success!</h2>
    <p>Admin mode activated</p>
    <button>OK</button>
  </div>
  <div class="class-edit-menu" id="classEditMenu">
    <div class="menu-content">
      <h3>Edit Class</h3>
      <button class="close-menu" id="closeClassEdit">✕</button>
      <div class="input-group">
        <label for="class-name-input">Class Name:</label>
        <input type="text" id="class-name-input">
      </div>
      <div class="menu-buttons">
        <button class="save-class-name" data-tooltip="Save class name">Save</button>
        <button class="delete-class" data-tooltip="Delete this class">Delete Class</button>
      </div>
    </div>
  </div>
  <div class="accounts-menu" id="accounts-menu">
    <button class="close-accounts-button" id="close-accounts" data-tooltip="Close accounts menu">×</button>
    <button id="modify-accounts" class="customization-button" data-tooltip="Modify existing user accounts">Modify</button>
    <button id="remove-accounts" class="customization-button" data-tooltip="Remove user accounts">Remove</button>
    <button id="create-accounts" class="customization-button" data-tooltip="Create new user accounts">Create</button>
  </div>
  <div id="debug-overlay"></div>
  <div id="debug-menu" class="debug-menu">
    <div class="debug-content">
      <button id="close-debug" class="close-menu" data-tooltip="Close debug menu">×</button>
      <h2>Debug Menu</h2>
      <button id="debug-reset-all" class="clear-data-button" data-tooltip="Delete all timetables permanently">Reset All Data</button>
      <button id="debug-create-new" class="customization-button" data-tooltip="Create a new class timetable">Create New Class</button>
      <button id="debug-accounts" class="customization-button" data-tooltip="Open accounts management">Accounts</button>
    </div>
  </div>

  <div class="date-picker-overlay" id="datePickerOverlay">
    <div class="date-picker-window">
      <h2>Set Current Date</h2>
      <div class="calendar" id="date-picker-calendar"></div>
      <div style="text-align: center; margin-top: 15px;">
        <button class="save-button" id="save-custom-date">Save</button>
        <button class="cancel-button" id="cancel-custom-date">Cancel</button>
      </div>
    </div>
  </div>

  <div class="custom-date-notice" id="customDateNotice">
    <span>Current date set to: <span id="customDateText"></span></span>
    <button class="reset-date-btn" id="resetDateBtn">Reset date</button>
  </div>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Saving changes...</div>
  </div>
  
  <!-- Add direct script to ensure admin button and debug mode are initialized -->
  <script>
    // Make sure Admin button is set up properly
    window.addEventListener('load', function() {
      if (typeof setupAdminButton === 'function') {
        setupAdminButton(); 
        console.log('Admin button setup initialized');
      } else {
        console.error('setupAdminButton function not found');
      }
      
      if (typeof setupDebugKeyHandlers === 'function') {
        setupDebugKeyHandlers();
        console.log('Debug key handlers initialized');
      } else {
        console.error('setupDebugKeyHandlers function not found');
      }
      
      // Make the admin button click event very direct
      const adminBtn = document.getElementById('admin-button');
      if (adminBtn) {
        adminBtn.addEventListener('click', function() {
          console.log('Admin button clicked directly');
          
          // Show verification window directly
          const verificationWindow = document.getElementById('verification-window');
          if (verificationWindow) {
            verificationWindow.style.display = 'flex';
            verificationWindow.classList.add('active');
            
            const verificationCode = document.getElementById('verification-code');
            if (verificationCode) {
              verificationCode.value = '';
              setTimeout(() => verificationCode.focus(), 100);
            }
          } else {
            console.error('Verification window not found');
          }
        });
      }
    });
  </script>

  <!-- Make sure HTML overlays and modals are properly structured -->
  <script>
    // Improve transitions by ensuring modals and overlays work together
    document.addEventListener('DOMContentLoaded', function() {
      // Helper function to show a modal with proper timing
      function showModal(modal, overlay) {
        // First display the elements but keep them invisible
        if (overlay) overlay.style.display = 'block';
        modal.style.display = 'block';
        
        // Force a reflow to ensure the display change applies before adding the active class
        void modal.offsetWidth;
        
        // Now add active class to trigger transition
        if (overlay) overlay.classList.add('active');
        modal.classList.add('active');
      }
      
      // Helper function to hide a modal with proper timing
      function hideModal(modal, overlay) {
        // First remove the active class to trigger transition
        modal.classList.remove('active');
        if (overlay) overlay.classList.remove('active');
        
        // After transition completes, set display to none
        setTimeout(() => {
          modal.style.display = 'none';
          if (overlay) overlay.style.display = 'none';
        }, 300);
      }
      
      // Apply to login button
      const loginButton = document.getElementById('login-button');
      const loginMenu = document.getElementById('login-menu');
      const loginOverlay = document.getElementById('login-overlay');
      
      if (loginButton && loginMenu && loginOverlay) {
        loginButton.addEventListener('click', function(e) {
          if (!loginButton.classList.contains('logged-in')) {
            e.preventDefault();
            showModal(loginMenu, loginOverlay);
          }
        });
      }
    });
  </script>

  <!-- Add a script to handle orientation changes -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Handle orientation changes
      window.addEventListener('orientationchange', function() {
        // Add a small delay to ensure the orientation has actually changed
        setTimeout(function() {
          // Force layout recalculation
          document.body.style.opacity = '0.99';
          setTimeout(function() { document.body.style.opacity = '1'; }, 10);
          
          // If there is a responsive setup function, call it
          if (typeof setupResponsiveDesign === 'function') {
            setupResponsiveDesign();
          }
          
          // If there is an update layout function, call it
          if (typeof updateResponsiveLayout === 'function') {
            updateResponsiveLayout();
          }
        }, 200);
      });
      
      // Set initial orientation class
      if (window.innerHeight > window.innerWidth) {
        document.body.classList.add('portrait');
        document.body.classList.remove('landscape');
      } else {
        document.body.classList.add('landscape');
        document.body.classList.remove('portrait');
      }
      
      // Update orientation class on change
      window.addEventListener('resize', function() {
        if (window.innerHeight > window.innerWidth) {
          document.body.classList.add('portrait');
          document.body.classList.remove('landscape');
        } else {
          document.body.classList.add('landscape');
          document.body.classList.remove('portrait');
        }
      });
    });
  </script>
</body>
</html>