<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day App</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/buttons.css">
</head>
<body>
  <header class="header" id="header">
    <h1 class="title">Zaber si</h1>
    <div class="window-controls">
        <button id="login-button">Login</button>
    </div>
  </header>

  <!-- Add login overlay and menu after header -->
  <div class="login-overlay" id="login-overlay"></div>
  <div class="login-menu" id="login-menu">
    <button class="close-accounts-button" id="close-login">×</button>
    <h3>User Login</h3>
    <div class="input-group">
        <label for="user-select">User:</label>
        <select id="user-select">
            <option value="">Select a user</option>
        </select>
    </div>
    <div class="input-group">
        <label for="password-input">Password:</label>
        <input type="password" id="password-input" placeholder="Enter password">
    </div>
    <div class="login-error" id="login-error"></div>
    <button id="submit-login">Login</button>
  </div>
  
  <!-- Replace the existing sidebar with this well-structured version -->
  <aside class="sidebar">
    <ul>
      <li id="dynamic-links-container"><!-- Dynamic buttons will be added here --></li>
      <li><button class="create-new" id="create-new">+</button></li>
    </ul>
    <button id="accounts-button">Accounts</button>
    <button class="admin-button" id="admin-button">Admin</button>
  </aside>

  <!-- Add accounts overlay -->
  <div class="accounts-overlay" id="accounts-overlay"></div>
  
  <div class="select-screen" id="select-screen">
    <div class="select-window">
      <button class="close-select" id="close-select">X</button>
      <div class="input-group">
        <label for="name-input">Name:</label>
        <input type="text" id="name-input" placeholder="Enter name">
      </div>
      <div class="input-group">
        <label for="type-select">Type:</label>
        <select id="type-select">
          <option value="thing">Thing</option>
          <option value="class">Class</option>
        </select>
      </div>
      <button class="submit-button" id="submit-button">Submit</button>
    </div>
  </div>
  
  <div class="time-table">
    <h2>Time Table</h2>
    <div class="timetable-content">
      <div class="table-container">
        <table class="week-table">
          <thead>
            <tr>
              <th>Day</th>
              <th>1</th>
              <th>2</th>
              <th>3</th>
              <th>4</th>
              <th>5</th>
              <th>6</th>
              <th>7</th>
              <th>8</th>
              <th>9</th>
              <th>10</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Pondělí</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Úterý</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Středa</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Čtvrtek</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Pátek</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="bottom-content">
        <div class="time-table-buttons">
          <button class="edit-button">Edit</button>
          <button class="save-button" style="display: none;">Save</button>
          
        </div>
        <div class="timetable-calendar">
          <div class="calendar-header">
            <button class="prev-button">&lt;</button>
            <h3 class="calendar-title" id="timetable-calendar-title"></h3>
            <button class="next-button">&gt;</button>
          </div>
          <div class="calendar" id="timetable-calendar"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="pop-up" id="pop-up">
    <div class="calendar-header">
      <h2 class="calendar-title" id="calendar-title"></h2>
    </div>
    <button class="close-button" id="close-button">X</button>
    <div class="calendar" id="calendar"></div>
    <div class="calendar-buttons">
      <button class="prev-button">&lt;</button>
      <button class="next-button">&gt;</button>
    </div>
  </div>
  <div class="verification-window" id="verification-window">
    <div class="verification-content">
      <h2>Verification</h2>
      <button class="close-verification-button" id="close-verification">X</button>
      <p>Please enter the code:</p>
      <input type="password" id="verification-code" placeholder="Enter code">
      <div class="verification-buttons">
        <button class="confirm-verification" id="confirm-verification">Confirm</button>
      </div>
    </div>
  </div>
  <script src="/js/renderer.js"></script>
  <script>
    // Add event listener to show save button when admin mode is activated
    document.getElementById('admin-button').addEventListener('click', function() {
      console.log('Admin button clicked');
      // Admin verification will now be handled in the setupAdminButton function
    });
    
    // Debug helper - logs when verification window appears/disappears
    const verificationWindow = document.getElementById('verification-window');
    if (verificationWindow) {
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.attributeName === 'style' || mutation.attributeName === 'class') {
            console.log('Verification window visibility changed:', 
              verificationWindow.style.display, 
              verificationWindow.classList.contains('active'));
          }
        });
      });
      
      observer.observe(verificationWindow, { attributes: true });
    }
    
    // Debug helper for keyboard shortcuts
    console.log('Debug mode can be activated with Shift+A+S');
    
    // Add a direct test button (only in development)
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
      const testButton = document.createElement('button');
      testButton.textContent = 'Debug Mode Test';
      testButton.style.position = 'fixed';
      testButton.style.bottom = '10px';
      testButton.style.left = '10px';
      testButton.style.zIndex = '9999';
      testButton.onclick = function() {
        document.body.classList.toggle('debug-mode');
        if (document.body.classList.contains('debug-mode')) {
          enableDebugMode();
        } else {
          disableDebugMode();
        }
      };
      
      document.body.appendChild(testButton);
    }
  </script>
  <div class="custom-alert-overlay" id="alertOverlay"></div>
  <div class="custom-alert" id="customAlert">
    <h2>Success!</h2>
    <p>Admin mode activated</p>
    <button>OK</button>
  </div>
  <div class="class-edit-menu" id="classEditMenu">
    <div class="menu-content">
      <h3>Edit Class</h3>
      <button class="close-menu" id="closeClassEdit">✕</button>
      <div class="input-group">
        <label for="class-name-input">Class Name:</label>
        <input type="text" id="class-name-input">
      </div>
      <div class="menu-buttons">
        <button class="save-class-name">Save</button>
        <button class="delete-class">Delete Class</button>
      </div>
    </div>
  </div>
  <div class="accounts-menu" id="accounts-menu">
    <button class="close-accounts-button" id="close-accounts">×</button>
    <button id="modify-accounts">Modify</button>
    <button id="remove-accounts">Remove</button>
    <button id="create-accounts">Create</button>
  </div>
  <div id="debug-overlay"></div>
  <div id="debug-menu">
      <h2>Debug Menu</h2>
      <button id="debug-reset-all">Reset All</button>
      <button id="debug-create-new">Create New Class</button>
      <button id="debug-accounts">Accounts</button>
      <button id="debug-set-date">Set current date</button>
      <button id="close-debug">Close</button>
  </div>

  <div class="date-picker-overlay" id="datePickerOverlay">
    <div class="date-picker-window">
      <h2>Set Current Date</h2>
      <div class="calendar" id="date-picker-calendar"></div>
      <div style="text-align: center; margin-top: 15px;">
        <button class="save-button" id="save-custom-date">Save</button>
        <button class="cancel-button" id="cancel-custom-date">Cancel</button>
      </div>
    </div>
  </div>

  <div class="custom-date-notice" id="customDateNotice">
    <span>Current date set to: <span id="customDateText"></span></span>
    <button class="reset-date-btn" id="resetDateBtn">Reset date</button>
  </div>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Saving changes...</div>
  </div>
  
  <!-- Add direct script to ensure admin button and debug mode are initialized -->
  <script>
    // Make sure Admin button is set up properly
    window.addEventListener('load', function() {
      if (typeof setupAdminButton === 'function') {
        setupAdminButton(); 
        console.log('Admin button setup initialized');
      } else {
        console.error('setupAdminButton function not found');
      }
      
      if (typeof setupDebugKeyHandlers === 'function') {
        setupDebugKeyHandlers();
        console.log('Debug key handlers initialized');
      } else {
        console.error('setupDebugKeyHandlers function not found');
      }
      
      // Make the admin button click event very direct
      const adminBtn = document.getElementById('admin-button');
      if (adminBtn) {
        adminBtn.addEventListener('click', function() {
          console.log('Admin button clicked directly');
          
          // Show verification window directly
          const verificationWindow = document.getElementById('verification-window');
          if (verificationWindow) {
            verificationWindow.style.display = 'flex';
            verificationWindow.classList.add('active');
            
            const verificationCode = document.getElementById('verification-code');
            if (verificationCode) {
              verificationCode.value = '';
              setTimeout(() => verificationCode.focus(), 100);
            }
          } else {
            console.error('Verification window not found');
          }
        });
      }
    });
  </script>

  <!-- Make sure HTML overlays and modals are properly structured -->
  <script>
    // Improve transitions by ensuring modals and overlays work together
    document.addEventListener('DOMContentLoaded', function() {
      // Helper function to show a modal with proper timing
      function showModal(modal, overlay) {
        // First display the elements but keep them invisible
        if (overlay) overlay.style.display = 'block';
        modal.style.display = 'block';
        
        // Force a reflow to ensure the display change applies before adding the active class
        void modal.offsetWidth;
        
        // Now add active class to trigger transition
        if (overlay) overlay.classList.add('active');
        modal.classList.add('active');
      }
      
      // Helper function to hide a modal with proper timing
      function hideModal(modal, overlay) {
        // First remove the active class to trigger transition
        modal.classList.remove('active');
        if (overlay) overlay.classList.remove('active');
        
        // After transition completes, set display to none
        setTimeout(() => {
          modal.style.display = 'none';
          if (overlay) overlay.style.display = 'none';
        }, 300);
      }
      
      // Apply to login button
      const loginButton = document.getElementById('login-button');
      const loginMenu = document.getElementById('login-menu');
      const loginOverlay = document.getElementById('login-overlay');
      
      if (loginButton && loginMenu && loginOverlay) {
        loginButton.addEventListener('click', function(e) {
          if (!loginButton.classList.contains('logged-in')) {
            e.preventDefault();
            showModal(loginMenu, loginOverlay);
          }
        });
      }
    });
  </script>
</body>
</html>