<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezervační aplikace</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/buttons.css">
</head>
<body>
  <header class="header" id="header">
    <h1 class="title">Rezervační systém školy</h1>
    <div class="window-controls">
        <button id="login-button">Přihlášení</button>
    </div>
  </header>

  <!-- Add login overlay and menu after header -->
  <div class="login-overlay" id="login-overlay"></div>
  <div class="login-menu" id="login-menu">
    <button class="close-accounts-button" id="close-login">×</button>
    <h3>Přihlášení uživatele</h3>
    <div class="input-group">
        <label for="user-select">Uživatel:</label>
        <select id="user-select">
            <option value="">Vyberte uživatele</option>
        </select>
    </div>
    <div class="input-group">
        <label for="password-input">Heslo:</label>
        <input type="password" id="password-input" placeholder="Zadejte heslo">
    </div>
    <div class="login-error" id="login-error"></div>
    <button id="submit-login">Přihlásit se</button>
  </div>
  
  <!-- Replace the existing sidebar with this well-structured version -->
  <aside class="sidebar">
    <ul>
      <li id="dynamic-links-container"><!-- Dynamic buttons will be added here --></li>
      <li><button class="create-new" id="create-new">+</button></li>
    </ul>
    <button id="accounts-button">Účty</button>
  </aside>

  <!-- Add accounts overlay -->
  <div class="accounts-overlay" id="accounts-overlay"></div>
  
  <div class="select-screen" id="select-screen">
    <div class="select-window">
      <button class="close-select" id="close-select">X</button>
      <div class="input-group">
        <label for="name-input">Název:</label>
        <input type="text" id="name-input" placeholder="Zadejte název">
      </div>
      <div class="input-group">
        <label for="type-select">Typ:</label>
        <select id="type-select">
          <option value="thing">Věc</option>
          <option value="class">Třída</option>
        </select>
      </div>
      <button class="submit-button" id="submit-button">Odeslat</button>
    </div>
  </div>
  
  <div class="time-table">
    <h2>Rozvrh hodin</h2>
    <div class="timetable-content">
      <div class="table-container">
        <table class="week-table">
          <thead>
            <tr>
              <th>Den</th>
              <th>1</th>
              <th>2</th>
              <th>3</th>
              <th>4</th>
              <th>5</th>
              <th>6</th>
              <th>7</th>
              <th>8</th>
              <th>9</th>
              <th>10</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Pondělí</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Úterý</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Středa</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Čtvrtek</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
            <tr>
              <td>Pátek</td>
              <td></td><td></td><td></td><td></td><td></td>
              <td></td><td></td><td></td><td></td><td></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="bottom-content">
        <div class="time-table-buttons">
          <button class="edit-button">Zamluvit hodinu</button>
          <button class="save-button" style="display: none;">Uložit</button>
          
        </div>
        <div class="timetable-calendar">
          <div class="calendar-header">
            <button class="prev-button">&lt;</button>
            <h3 class="calendar-title" id="timetable-calendar-title"></h3>
            <button class="next-button">&gt;</button>
          </div>
          <div class="calendar" id="timetable-calendar"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="pop-up" id="pop-up">
    <div class="calendar-header">
      <h2 class="calendar-title" id="calendar-title"></h2>
    </div>
    <button class="close-button" id="close-button">X</button>
    <div class="calendar" id="calendar"></div>
    <div class="calendar-buttons">
      <button class="prev-button">&lt;</button>
      <button class="next-button">&gt;</button>
    </div>
  </div>
  <div class="verification-window" id="verification-window">
    <div class="verification-content">
      <h2>Ověření</h2>
      <button class="close-verification-button" id="close-verification">X</button>
      <p>Prosím zadejte kód:</p>
      <input type="password" id="verification-code" placeholder="Zadejte kód">
      <div class="verification-buttons">
        <button class="confirm-verification" id="confirm-verification">Potvrdit</button>
      </div>
    </div>
  </div>
  <script src="/js/renderer.js"></script>
  <script>
    // Add event listener to show save button when admin mode is activated
    // Admin button removed - admin functionality now accessible through debug mode only
    
    // Debug helper - logs when verification window appears/disappears
    const verificationWindow = document.getElementById('verification-window');
    if (verificationWindow) {
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.attributeName === 'style' || mutation.attributeName === 'class') {
            console.log('Verification window visibility changed:', 
              verificationWindow.style.display, 
              verificationWindow.classList.contains('active'));
          }
        });
      });
      
      observer.observe(verificationWindow, { attributes: true });
    }
    
    // Debug helper for keyboard shortcuts
    console.log('Debug mode can be activated with Shift+A+S');
    
    // Add a direct test button (only in development)
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
      const testButton = document.createElement('button');
      testButton.textContent = 'Debug Mode Test';
      testButton.style.position = 'fixed';
      testButton.style.bottom = '10px';
      testButton.style.left = '10px';
      testButton.style.zIndex = '9999';
      testButton.onclick = function() {
        document.body.classList.toggle('debug-mode');
        if (document.body.classList.contains('debug-mode')) {
          enableDebugMode();
        } else {
          disableDebugMode();
        }
      };
      
      document.body.appendChild(testButton);
    }
  </script>
  <div class="custom-alert-overlay" id="alertOverlay"></div>
  <div class="custom-alert" id="customAlert">
    <h2>Úspěch!</h2>
    <p>Režim administrátora aktivován</p>
    <button>OK</button>
  </div>
  <div class="class-edit-menu" id="classEditMenu">
    <div class="menu-content">
      <h3>Upravit třídu</h3>
      <button class="close-menu" id="closeClassEdit">✕</button>
      <div class="input-group">
        <label for="class-name-input">Název třídy:</label>
        <input type="text" id="class-name-input">
      </div>
      <div class="menu-buttons">
        <button class="save-class-name">Uložit</button>
        <button class="delete-class">Smazat třídu</button>
      </div>
    </div>
  </div>
  <div class="accounts-menu" id="accounts-menu">
    <button class="close-accounts-button" id="close-accounts">×</button>
    <button id="modify-accounts">Upravit</button>
    <button id="remove-accounts">Odebrat</button>
    <button id="create-accounts">Vytvořit</button>
  </div>
  <div id="debug-overlay"></div>
  <div id="debug-menu">
      <h2>Ladicí menu</h2>
      <button id="debug-reset-all">Resetovat vše</button>
      <button id="debug-create-new">Vytvořit novou třídu</button>
      <button id="debug-accounts">Účty</button>
      <button id="debug-set-date">Nastavit aktuální datum</button>
      <button id="close-debug">Zavřít</button>
  </div>

  <div class="date-picker-overlay" id="datePickerOverlay">
    <div class="date-picker-window">
      <h2>Nastavit aktuální datum</h2>
      <div class="calendar" id="date-picker-calendar"></div>
      <div style="text-align: center; margin-top: 15px;">
        <button class="save-button" id="save-custom-date">Uložit</button>
        <button class="cancel-button" id="cancel-custom-date">Zrušit</button>
      </div>
    </div>
  </div>

  <div class="custom-date-notice" id="customDateNotice">
    <span>Aktuální datum nastaveno na: <span id="customDateText"></span></span>
    <button class="reset-date-btn" id="resetDateBtn">Resetovat datum</button>
  </div>
  
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Ukládání změn...</div>
  </div>

  <!-- Permanent Hour Date Range Selector -->
  <div class="permanent-date-overlay" id="permanentDateOverlay">
    <div class="permanent-date-window">
      <h2>Nastavit rozsah dat pro trvalou hodinu</h2>
      <button class="close-permanent-date" id="closePermanentDate">×</button>
      
      <div class="date-range-inputs">
        <div class="input-group">
          <label for="permanent-from-date">Od data:</label>
          <input type="date" id="permanent-from-date">
        </div>
        <div class="input-group">
          <label for="permanent-to-date">Do data:</label>
          <input type="date" id="permanent-to-date">
        </div>
      </div>
      
      <div class="permanent-options">
        <label>
          <input type="checkbox" id="permanent-all-weeks" checked>
          Použít pro všechny týdny (ignorovat rozsah dat)
        </label>
      </div>
      
      <div class="permanent-buttons">
        <button class="save-permanent-button" id="save-permanent-range">Uložit</button>
        <button class="cancel-permanent-button" id="cancel-permanent-range">Zrušit</button>
      </div>
    </div>
  </div>
  
  <!-- Add direct script to ensure debug mode is initialized -->
  <script>
    // Make sure Debug mode is set up properly
    window.addEventListener('load', function() {      
      if (typeof setupDebugKeyHandlers === 'function') {
        setupDebugKeyHandlers();
        console.log('Debug key handlers initialized');
      } else {
        console.error('setupDebugKeyHandlers function not found');
      }
    });
  </script>

  <!-- Make sure HTML overlays and modals are properly structured -->
  <script>
    // Improve transitions by ensuring modals and overlays work together
    document.addEventListener('DOMContentLoaded', function() {
      // Helper function to show a modal with proper timing
      function showModal(modal, overlay) {
        // First display the elements but keep them invisible
        if (overlay) overlay.style.display = 'block';
        modal.style.display = 'block';
        
        // Force a reflow to ensure the display change applies before adding the active class
        void modal.offsetWidth;
        
        // Now add active class to trigger transition
        if (overlay) overlay.classList.add('active');
        modal.classList.add('active');
      }
      
      // Helper function to hide a modal with proper timing
      function hideModal(modal, overlay) {
        // First remove the active class to trigger transition
        modal.classList.remove('active');
        if (overlay) overlay.classList.remove('active');
        
        // After transition completes, set display to none
        setTimeout(() => {
          modal.style.display = 'none';
          if (overlay) overlay.style.display = 'none';
        }, 300);
      }
      
      // Apply to login button
      const loginButton = document.getElementById('login-button');
      const loginMenu = document.getElementById('login-menu');
      const loginOverlay = document.getElementById('login-overlay');
      
      if (loginButton && loginMenu && loginOverlay) {
        loginButton.addEventListener('click', function(e) {
          if (!loginButton.classList.contains('logged-in')) {
            e.preventDefault();
            showModal(loginMenu, loginOverlay);
          }
        });
      }
    });
  </script>
</body>
</html>